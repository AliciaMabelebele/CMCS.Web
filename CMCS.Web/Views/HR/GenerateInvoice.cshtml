@model CMCS.Web.Models.ViewModels.InvoiceViewModel
@{
    ViewData["Title"] = "Generate Invoice";
    var fromDate = Model.FromDate.ToString("yyyy-MM-dd");
    var toDate = Model.ToDate.ToString("yyyy-MM-dd");
}

<div class="container mt-4 mb-5">
    <div class="row mb-4">
        <div class="col">
            <h2 class="fw-bold">
                <i class="bi bi-file-earmark-text me-2"></i>Generate Payment Invoice
            </h2>
        </div>
        <div class="col-auto">
            <button onclick="window.print()" class="btn btn-primary me-2">
                <i class="bi bi-printer me-2"></i>Print
            </button>
            <a asp-action="Index" class="btn btn-secondary">
                <i class="bi bi-arrow-left me-2"></i>Back
            </a>
        </div>
    </div>

    <div class="card shadow mb-4 no-print">
        <div class="card-body">
            <form method="get" class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label class="form-label fw-semibold">From Date</label>
                    <input type="date" name="fromDate" class="form-control" value="@fromDate" />
                </div>
                <div class="col-md-4">
                    <label class="form-label fw-semibold">To Date</label>
                    <input type="date"
                           name="toDate" class="form-control" value="@toDate" />
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-funnel me-2"></i>Filter
                    </button>
                </div>
            </form>
        </div>
    </div>
    <div class="card shadow" id="invoice">
        <div class="card-body p-5">
            <div class="row mb-4">
                <div class="col-6">
                    <h1 class="fw-bold text-primary">INVOICE</h1>
                    <p class="text-muted mb-0">Contract Monthly Claim System</p>
                </div>
                <div class="col-6 text-end">
                    <p class="mb-1"><strong>Invoice Date:</strong> @Model.GeneratedDate.ToString("dd MMMM yyyy")</p>
                    <p class="mb-1"><strong>Period:</strong> @Model.FromDate.ToString("dd MMM yyyy") - @Model.ToDate.ToString("dd MMM yyyy")</p>
                    <p class="mb-0"><strong>Generated By:</strong> @Model.GeneratedBy</p>
                </div>
            </div>

            <hr class="mb-4">

            <h5 class="fw-bold mb-3">Approved Claims for Payment</h5>

            @if (Model.ApprovedClaims.Any())
            {
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>Claim ID</th>
                                <th>Lecturer</th>
                                <th>Department</th>
                                <th>Hours</th>
                                <th>Rate</th>
                                <th class="text-end">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var claim in Model.ApprovedClaims)
                            {
                                <tr>
                                    <td>#@claim.ClaimId</td>
                                    <td>@claim.Lecturer?.FullName</td>
                                    <td>@claim.Lecturer?.Department</td>
                                    <td>@claim.HoursWorked</td>
                                    <td>R @claim.HourlyRate.ToString("N2")</td>
                                    <td class="text-end fw-semibold">R @claim.TotalAmount.ToString("N2")</td>
                                </tr>
                            }
                        </tbody>
                        <tfoot class="table-light">
                            <tr>
                                <td colspan="5" class="text-end fw-bold">TOTAL AMOUNT:</td>
                                <td class="text-end">
                                    <h5 class="fw-bold text-success mb-0">R @Model.TotalAmount.ToString("N2")</h5>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="fw-bold mb-3">Payment Summary</h6>
                                <p class="mb-1">Total Claims: <strong>@Model.ApprovedClaims.Count</strong></p>
                                <p class="mb-1">Total Hours: <strong>@Model.ApprovedClaims.Sum(c => c.HoursWorked)</strong></p>
                                <p class="mb-0">Total Lecturers: <strong>@Model.ApprovedClaims.Select(c => c.LecturerId).Distinct().Count()</strong></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-success bg-opacity-10">
                            <div class="card-body">
                                <h6 class="fw-bold mb-3">Total Payment Required</h6>
                                <h2 class="text-success mb-0">R @Model.TotalAmount.ToString("N2")</h2>
                            </div>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    No approved claims found for the selected period.
                </div>
            }

            <hr class="mt-5 mb-4">
            <div class="text-center text-muted small">
                <p class="mb-1">This is an automatically generated invoice from the Contract Monthly Claim System</p>
                <p class="mb-0">For queries, please contact the HR department</p>
            </div>
        </div>
    </div>
</div>
<style>
    @@media print {
        .no-print {
            display: none !important;
        }

        .btn {
            display: none !important;
        }

        body {
            background: white !important;
        }

        .card {
            border: none !important;
            box-shadow: none !important;
        }
    }
</style>